version: 2.1
jobs:
      run_tests:
            docker:
                  - image: circleci/python:3.8.2
            steps:
                  - checkout
                  - run:
                        name: Install Python Dependencies
                        command: |
                              echo 'export PATH=~$PATH:~/.local/bin' >> $BASH_ENV && source $BASH_ENV
                              pip install -Iv Cython==0.29.12
                              pip install --user -r requirements.txt
                  - run:
                        name: Run Integration Tests
                        command: |
                              pytest --cov=./ --junitxml=test-reports/junit.xml --html=test-reports/pytest_report.html --self-contained-html test.py
                  - store_test_results:
                        path: test-reports
                  - store_artifacts:
                        path: test-reports
                  - run:
                        name: Upload CodeCov Report
                        command: |
                              codecov --token=3a29a7f0-97b0-407b-8bb6-d89f5136bd8a
workflows:
      build_test:
            jobs:
                  - run_tests
